{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/Users/taykim/Desktop/cs98/cs98_fall_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js\").default;\nvar _slicedToArray = require(\"/Users/taykim/Desktop/cs98/cs98_fall_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _taggedTemplateLiteral = require(\"/Users/taykim/Desktop/cs98/cs98_fall_demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js\").default;\nvar _templateObject, _templateObject2, _templateObject3;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.validateSchemaDeps = exports.validatePropertyDeps = exports.error = void 0;\nvar codegen_1 = require(\"../../compile/codegen\");\nvar util_1 = require(\"../../compile/util\");\nvar code_1 = require(\"../code\");\nexports.error = {\n  message: function message(_ref) {\n    var _ref$params = _ref.params,\n      property = _ref$params.property,\n      depsCount = _ref$params.depsCount,\n      deps = _ref$params.deps;\n    var property_ies = depsCount === 1 ? \"property\" : \"properties\";\n    return (0, codegen_1.str)(_templateObject || (_templateObject = _taggedTemplateLiteral([\"must have \", \" \", \" when property \", \" is present\"])), property_ies, deps, property);\n  },\n  params: function params(_ref2) {\n    var _ref2$params = _ref2.params,\n      property = _ref2$params.property,\n      depsCount = _ref2$params.depsCount,\n      deps = _ref2$params.deps,\n      missingProperty = _ref2$params.missingProperty;\n    return (0, codegen_1._)(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"{property: \", \",\\n    missingProperty: \", \",\\n    depsCount: \", \",\\n    deps: \", \"}\"])), property, missingProperty, depsCount, deps);\n  } // TODO change to reference\n};\n\nvar def = {\n  keyword: \"dependencies\",\n  type: \"object\",\n  schemaType: \"object\",\n  error: exports.error,\n  code: function code(cxt) {\n    var _splitDependencies = splitDependencies(cxt),\n      _splitDependencies2 = _slicedToArray(_splitDependencies, 2),\n      propDeps = _splitDependencies2[0],\n      schDeps = _splitDependencies2[1];\n    validatePropertyDeps(cxt, propDeps);\n    validateSchemaDeps(cxt, schDeps);\n  }\n};\nfunction splitDependencies(_ref3) {\n  var schema = _ref3.schema;\n  var propertyDeps = {};\n  var schemaDeps = {};\n  for (var key in schema) {\n    if (key === \"__proto__\") continue;\n    var deps = Array.isArray(schema[key]) ? propertyDeps : schemaDeps;\n    deps[key] = schema[key];\n  }\n  return [propertyDeps, schemaDeps];\n}\nfunction validatePropertyDeps(cxt) {\n  var propertyDeps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : cxt.schema;\n  var gen = cxt.gen,\n    data = cxt.data,\n    it = cxt.it;\n  if (Object.keys(propertyDeps).length === 0) return;\n  var missing = gen.let(\"missing\");\n  var _loop = function _loop(prop) {\n    var deps = propertyDeps[prop];\n    if (deps.length === 0) return \"continue\";\n    var hasProperty = (0, code_1.propertyInData)(gen, data, prop, it.opts.ownProperties);\n    cxt.setParams({\n      property: prop,\n      depsCount: deps.length,\n      deps: deps.join(\", \")\n    });\n    if (it.allErrors) {\n      gen.if(hasProperty, function () {\n        var _iterator = _createForOfIteratorHelper(deps),\n          _step;\n        try {\n          for (_iterator.s(); !(_step = _iterator.n()).done;) {\n            var depProp = _step.value;\n            (0, code_1.checkReportMissingProp)(cxt, depProp);\n          }\n        } catch (err) {\n          _iterator.e(err);\n        } finally {\n          _iterator.f();\n        }\n      });\n    } else {\n      gen.if((0, codegen_1._)(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"\", \" && (\", \")\"])), hasProperty, (0, code_1.checkMissingProp)(cxt, deps, missing)));\n      (0, code_1.reportMissingProp)(cxt, missing);\n      gen.else();\n    }\n  };\n  for (var prop in propertyDeps) {\n    var _ret = _loop(prop);\n    if (_ret === \"continue\") continue;\n  }\n}\nexports.validatePropertyDeps = validatePropertyDeps;\nfunction validateSchemaDeps(cxt) {\n  var schemaDeps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : cxt.schema;\n  var gen = cxt.gen,\n    data = cxt.data,\n    keyword = cxt.keyword,\n    it = cxt.it;\n  var valid = gen.name(\"valid\");\n  var _loop2 = function _loop2(prop) {\n    if ((0, util_1.alwaysValidSchema)(it, schemaDeps[prop])) return \"continue\";\n    gen.if((0, code_1.propertyInData)(gen, data, prop, it.opts.ownProperties), function () {\n      var schCxt = cxt.subschema({\n        keyword: keyword,\n        schemaProp: prop\n      }, valid);\n      cxt.mergeValidEvaluated(schCxt, valid);\n    }, function () {\n      return gen.var(valid, true);\n    } // TODO var\n    );\n\n    cxt.ok(valid);\n  };\n  for (var prop in schemaDeps) {\n    var _ret2 = _loop2(prop);\n    if (_ret2 === \"continue\") continue;\n  }\n}\nexports.validateSchemaDeps = validateSchemaDeps;\nexports.default = def;","map":{"version":3,"sources":["../../../lib/vocabularies/applicator/dependencies.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.validateSchemaDeps = exports.validatePropertyDeps = exports.error = void 0;\nconst codegen_1 = require(\"../../compile/codegen\");\nconst util_1 = require(\"../../compile/util\");\nconst code_1 = require(\"../code\");\nexports.error = {\n    message: ({ params: { property, depsCount, deps } }) => {\n        const property_ies = depsCount === 1 ? \"property\" : \"properties\";\n        return (0, codegen_1.str) `must have ${property_ies} ${deps} when property ${property} is present`;\n    },\n    params: ({ params: { property, depsCount, deps, missingProperty } }) => (0, codegen_1._) `{property: ${property},\n    missingProperty: ${missingProperty},\n    depsCount: ${depsCount},\n    deps: ${deps}}`, // TODO change to reference\n};\nconst def = {\n    keyword: \"dependencies\",\n    type: \"object\",\n    schemaType: \"object\",\n    error: exports.error,\n    code(cxt) {\n        const [propDeps, schDeps] = splitDependencies(cxt);\n        validatePropertyDeps(cxt, propDeps);\n        validateSchemaDeps(cxt, schDeps);\n    },\n};\nfunction splitDependencies({ schema }) {\n    const propertyDeps = {};\n    const schemaDeps = {};\n    for (const key in schema) {\n        if (key === \"__proto__\")\n            continue;\n        const deps = Array.isArray(schema[key]) ? propertyDeps : schemaDeps;\n        deps[key] = schema[key];\n    }\n    return [propertyDeps, schemaDeps];\n}\nfunction validatePropertyDeps(cxt, propertyDeps = cxt.schema) {\n    const { gen, data, it } = cxt;\n    if (Object.keys(propertyDeps).length === 0)\n        return;\n    const missing = gen.let(\"missing\");\n    for (const prop in propertyDeps) {\n        const deps = propertyDeps[prop];\n        if (deps.length === 0)\n            continue;\n        const hasProperty = (0, code_1.propertyInData)(gen, data, prop, it.opts.ownProperties);\n        cxt.setParams({\n            property: prop,\n            depsCount: deps.length,\n            deps: deps.join(\", \"),\n        });\n        if (it.allErrors) {\n            gen.if(hasProperty, () => {\n                for (const depProp of deps) {\n                    (0, code_1.checkReportMissingProp)(cxt, depProp);\n                }\n            });\n        }\n        else {\n            gen.if((0, codegen_1._) `${hasProperty} && (${(0, code_1.checkMissingProp)(cxt, deps, missing)})`);\n            (0, code_1.reportMissingProp)(cxt, missing);\n            gen.else();\n        }\n    }\n}\nexports.validatePropertyDeps = validatePropertyDeps;\nfunction validateSchemaDeps(cxt, schemaDeps = cxt.schema) {\n    const { gen, data, keyword, it } = cxt;\n    const valid = gen.name(\"valid\");\n    for (const prop in schemaDeps) {\n        if ((0, util_1.alwaysValidSchema)(it, schemaDeps[prop]))\n            continue;\n        gen.if((0, code_1.propertyInData)(gen, data, prop, it.opts.ownProperties), () => {\n            const schCxt = cxt.subschema({ keyword, schemaProp: prop }, valid);\n            cxt.mergeValidEvaluated(schCxt, valid);\n        }, () => gen.var(valid, true) // TODO var\n        );\n        cxt.ok(valid);\n    }\n}\nexports.validateSchemaDeps = validateSchemaDeps;\nexports.default = def;\n//# sourceMappingURL=dependencies.js.map"]},"metadata":{},"sourceType":"script"}