{"ast":null,"code":"import _regeneratorRuntime from\"/Users/taykim/Desktop/cs98/project-22f-zk-vote/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/Users/taykim/Desktop/cs98/project-22f-zk-vote/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _objectWithoutProperties from\"/Users/taykim/Desktop/cs98/project-22f-zk-vote/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _slicedToArray from\"/Users/taykim/Desktop/cs98/project-22f-zk-vote/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _asyncToGenerator from\"/Users/taykim/Desktop/cs98/project-22f-zk-vote/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var _excluded=[\"isLoading\",\"children\"];import React,{useState}from\"react\";import{Framework}from\"@superfluid-finance/sdk-core\";import{Button,Form,FormGroup,FormControl,Spinner}from\"react-bootstrap\";import\"../css/createFlow.css\";import{ethers}from\"ethers\";//where the Superfluid logic takes place\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function createNewFlow(_x,_x2){return _createNewFlow.apply(this,arguments);}function _createNewFlow(){_createNewFlow=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(recipient,flowRate){var provider,signer,chainId,sf,DAIxContract,DAIx,createFlowOperation,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:provider=new ethers.providers.Web3Provider(window.ethereum);signer=provider.getSigner();console.log(signer._address);_context.next=5;return window.ethereum.request({method:\"eth_chainId\"});case 5:chainId=_context.sent;_context.next=8;return Framework.create({chainId:Number(chainId),provider:provider});case 8:sf=_context.sent;_context.next=11;return sf.loadSuperToken(\"fDAIx\");case 11:DAIxContract=_context.sent;DAIx=DAIxContract.address;_context.prev=13;createFlowOperation=sf.cfaV1.createFlow({receiver:recipient,flowRate:flowRate,superToken:DAIx// userData?: string\n});console.log(\"Creating your stream...\");_context.next=18;return createFlowOperation.exec(signer);case 18:result=_context.sent;console.log(result);console.log(\"Congrats - you've just created a money stream!\\n    View Your Stream At: https://app.superfluid.finance/dashboard/\".concat(recipient,\"\\n    Network: Kovan\\n    Super Token: DAIx\\n    Sender: \").concat(signer._address,\",\\n    Receiver: \").concat(recipient,\",\\n    FlowRate: \").concat(flowRate,\"\\n    \"));_context.next=27;break;case 23:_context.prev=23;_context.t0=_context[\"catch\"](13);console.log(\"Hmmm, your transaction threw an error. Make sure that this stream does not already exist, and that you've entered a valid Ethereum address!\");console.error(_context.t0);case 27:case\"end\":return _context.stop();}}},_callee,null,[[13,23]]);}));return _createNewFlow.apply(this,arguments);}export var CreateFlow=function CreateFlow(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),recipient=_useState2[0],setRecipient=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isButtonLoading=_useState4[0],setIsButtonLoading=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),flowRate=_useState6[0],setFlowRate=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),flowRateDisplay=_useState8[0],setFlowRateDisplay=_useState8[1];function calculateFlowRate(amount){if(typeof Number(amount)!==\"number\"||isNaN(Number(amount))===true){alert(\"You can only calculate a flowRate based on a number\");return;}else if(typeof Number(amount)===\"number\"){if(Number(amount)===0){return 0;}var amountInWei=ethers.BigNumber.from(amount);var monthlyAmount=ethers.utils.formatEther(amountInWei.toString());var calculatedFlowRate=monthlyAmount*3600*24*30;return calculatedFlowRate;}}function CreateButton(_ref){var isLoading=_ref.isLoading,children=_ref.children,props=_objectWithoutProperties(_ref,_excluded);return/*#__PURE__*/_jsx(Button,_objectSpread(_objectSpread({variant:\"success\",className:\"button\"},props),{},{children:isButtonLoading?/*#__PURE__*/_jsx(Spinner,{animation:\"border\"}):children}));}var handleRecipientChange=function handleRecipientChange(e){setRecipient(function(){var _e$target$value,_e$target$value2;return _e$target$value=e.target.value,_e$target$value2=_slicedToArray(_e$target$value,1),e.target.name=_e$target$value2[0],_e$target$value;});};var handleFlowRateChange=function handleFlowRateChange(e){setFlowRate(function(){var _e$target$value3,_e$target$value4;return _e$target$value3=e.target.value,_e$target$value4=_slicedToArray(_e$target$value3,1),e.target.name=_e$target$value4[0],_e$target$value3;});var newFlowRateDisplay=calculateFlowRate(e.target.value);setFlowRateDisplay(newFlowRateDisplay.toString());};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Create New Stream\"}),/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(FormGroup,{className:\"mb-3\",children:/*#__PURE__*/_jsx(FormControl,{name:\"recipient\",value:recipient,onChange:handleRecipientChange,placeholder:\"Enter recipient address\"})}),/*#__PURE__*/_jsx(FormGroup,{className:\"mb-3\",children:/*#__PURE__*/_jsx(FormControl,{name:\"flowRate\",value:flowRate,onChange:handleFlowRateChange,placeholder:\"Enter a flowRate in wei/second\"})}),/*#__PURE__*/_jsx(CreateButton,{onClick:function onClick(){setIsButtonLoading(true);createNewFlow(recipient,flowRate);setTimeout(function(){setIsButtonLoading(false);},1000);},children:\"Click to Create Your Stream\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"calculation\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"Your flow will be equal to:\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsxs(\"b\",{children:[\"$\",flowRateDisplay!==\" \"?flowRateDisplay:0]}),\" DAIx/month\"]})]})]});};","map":{"version":3,"names":["React","useState","Framework","Button","Form","FormGroup","FormControl","Spinner","ethers","createNewFlow","recipient","flowRate","provider","providers","Web3Provider","window","ethereum","signer","getSigner","console","log","_address","request","method","chainId","create","Number","sf","loadSuperToken","DAIxContract","DAIx","address","createFlowOperation","cfaV1","createFlow","receiver","superToken","exec","result","error","CreateFlow","setRecipient","isButtonLoading","setIsButtonLoading","setFlowRate","flowRateDisplay","setFlowRateDisplay","calculateFlowRate","amount","isNaN","alert","amountInWei","BigNumber","from","monthlyAmount","utils","formatEther","toString","calculatedFlowRate","CreateButton","isLoading","children","props","handleRecipientChange","e","target","value","name","handleFlowRateChange","newFlowRateDisplay","setTimeout"],"sources":["/Users/taykim/Desktop/cs98/project-22f-zk-vote/src/components/CreateFlow.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport { Framework } from \"@superfluid-finance/sdk-core\";\nimport {\n  Button,\n  Form,\n  FormGroup,\n  FormControl,\n  Spinner,\n} from \"react-bootstrap\";\nimport \"../css/createFlow.css\";\nimport { ethers } from \"ethers\";\n\n//where the Superfluid logic takes place\nasync function createNewFlow(recipient, flowRate) {\n  const provider = new ethers.providers.Web3Provider(window.ethereum);\n\n  const signer = provider.getSigner();\n\n  console.log(signer._address);\n  \n  const chainId = await window.ethereum.request({ method: \"eth_chainId\" });\n  const sf = await Framework.create({\n    chainId: Number(chainId),\n    provider: provider\n  });\n\n  const DAIxContract = await sf.loadSuperToken(\"fDAIx\");\n  const DAIx = DAIxContract.address;\n\n  try {\n    const createFlowOperation = sf.cfaV1.createFlow({\n      receiver: recipient,\n      flowRate: flowRate,\n      superToken: DAIx\n      // userData?: string\n    });\n\n    console.log(\"Creating your stream...\");\n\n    const result = await createFlowOperation.exec(signer);\n    console.log(result);\n\n    console.log(\n      `Congrats - you've just created a money stream!\n    View Your Stream At: https://app.superfluid.finance/dashboard/${recipient}\n    Network: Kovan\n    Super Token: DAIx\n    Sender: ${signer._address},\n    Receiver: ${recipient},\n    FlowRate: ${flowRate}\n    `\n    );\n  } catch (error) {\n    console.log(\n      \"Hmmm, your transaction threw an error. Make sure that this stream does not already exist, and that you've entered a valid Ethereum address!\"\n    );\n    console.error(error);\n  }\n}\n\nexport const CreateFlow = () => {\n  const [recipient, setRecipient] = useState(\"\");\n  const [isButtonLoading, setIsButtonLoading] = useState(false);\n  const [flowRate, setFlowRate] = useState(\"\");\n  const [flowRateDisplay, setFlowRateDisplay] = useState(\"\");\n\n  function calculateFlowRate(amount) {\n    if (typeof Number(amount) !== \"number\" || isNaN(Number(amount)) === true) {\n      alert(\"You can only calculate a flowRate based on a number\");\n      return;\n    } else if (typeof Number(amount) === \"number\") {\n      if (Number(amount) === 0) {\n        return 0;\n      }\n      const amountInWei = ethers.BigNumber.from(amount);\n      const monthlyAmount = ethers.utils.formatEther(amountInWei.toString());\n      const calculatedFlowRate = monthlyAmount * 3600 * 24 * 30;\n      return calculatedFlowRate;\n    }\n  }\n\n  function CreateButton({ isLoading, children, ...props }) {\n    return (\n      <Button variant=\"success\" className=\"button\" {...props}>\n        {isButtonLoading ? <Spinner animation=\"border\" /> : children}\n      </Button>\n    );\n  }\n\n  const handleRecipientChange = (e) => {\n    setRecipient(() => ([e.target.name] = e.target.value));\n  };\n\n  const handleFlowRateChange = (e) => {\n    setFlowRate(() => ([e.target.name] = e.target.value));\n    let newFlowRateDisplay = calculateFlowRate(e.target.value);\n    setFlowRateDisplay(newFlowRateDisplay.toString());\n  };\n\n  return (\n    <div>\n      <h3>Create New Stream</h3>\n      <Form>\n        <FormGroup className=\"mb-3\">\n          <FormControl\n            name=\"recipient\"\n            value={recipient}\n            onChange={handleRecipientChange}\n            placeholder=\"Enter recipient address\"\n          ></FormControl>\n        </FormGroup>\n        <FormGroup className=\"mb-3\">\n          <FormControl\n            name=\"flowRate\"\n            value={flowRate}\n            onChange={handleFlowRateChange}\n            placeholder=\"Enter a flowRate in wei/second\"\n          ></FormControl>\n        </FormGroup>\n        <CreateButton\n          onClick={() => {\n            setIsButtonLoading(true);\n            createNewFlow(recipient, flowRate);\n            setTimeout(() => {\n              setIsButtonLoading(false);\n            }, 1000);\n          }}\n        >\n          Click to Create Your Stream\n        </CreateButton>\n      </Form>\n\n      <div className=\"calculation\">\n        <p>Your flow will be equal to:</p>\n        <p>\n          <b>${flowRateDisplay !== \" \" ? flowRateDisplay : 0}</b> DAIx/month\n        </p>\n      </div>\n      \n    </div>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}